/*! Messages Manager - v1.4
* Copyright (c) 2015 , Gurtam
* Licensed  MIT */
function execCallback(b){return a[b]?(a[b].call(),void delete a[b]):null}var a={};!function(b,c){function d(){return-1!==navigator.appVersion.indexOf("MSIE 6")||-1!==navigator.appVersion.indexOf("MSIE 7")||-1!==navigator.appVersion.indexOf("MSIE 8")}function e(b){var c=(new Date).getTime();return a[c]=b,c}function f(a,b){var c=document.createElement("script");if(c.setAttribute("type","text/javascript"),c.setAttribute("charset","UTF-8"),c.setAttribute("src",a),b&&"function"==typeof b){{e(b)}d()?c.onreadystatechange=function(){("complete"===this.readyState||"loaded"==this.readyState)&&b()}:c.setAttribute("onLoad","execCallback("+e(b)+")")}document.getElementsByTagName("head")[0].appendChild(c)}function g(a){for(var c="",d=0,e=a.length;e>d;d++){var f=a[d];if(f){var g=f.getUserAccess();wialon.util.Number.and(wialon.item.Item.accessFlag.execReports,g)&&(c+="<option value='"+f.getId()+"'>"+f.getName()+"</option>")}}b("#units-select").html(c).change()}function h(a){if(a)return void alert(b.localise.tr("Invalid user name or password"));z();var c={itemsType:"avl_unit",propName:"sys_name",propValueMask:"*",sortType:"sys_name"},d=wialon.item.Item.dataFlag.base|wialon.item.Unit.dataFlag.lastMessage;wialon.core.Session.getInstance().searchItems(c,!0,d,0,0,function(a,b){wialon.core.Session.getInstance().getCurrUser().getLocale(function(c,d){var e=d&&d.fd?d.fd:"%Y-%m-%E_%H:%M:%S";U=wialon.util.DateTime.convertFormat(e,!0).replace(/_/,"&nbsp;&nbsp;").replace(/ /,"&nbsp;"),P(),!a&&b&&b.items&&b.items.length&&(g(b.items),H(d&&d.wd&&d.wd>1?0:1,e),A())})})}function i(){var a=mb("baseUrl");if(a||(a=mb("hostUrl")),!a)return null;var b=mb("user")||"";wialon.core.Session.getInstance().initSession(a,"",2048);var c=mb("sid"),d=mb("authHash");d?wialon.core.Session.getInstance().loginAuthHash(d,h):c&&wialon.core.Session.getInstance().duplicate(c,b,!0,h),R=wialon.core.Session.getInstance().getMessagesLoader()}function j(){if(jQuery("#filter").removeClass("active"),jb[Z]=ib,Z=parseInt(b("#msg_type").val()),0==Z)ib=jb[Z]||{},jQuery("#by_speed").show(),jQuery("#by_sat").show();else{if(1536!=Z)return ib={},jQuery("#filter").addClass("disabled"),void(kb=0);ib=jb[Z]||{},jQuery("#by_speed").hide(),jQuery("#by_sat").hide()}ib.param||ib.speed_from||ib.speed_to||ib.sat_from||ib.sat_to?jQuery("#filter").addClass("active"):jQuery("#filter").removeClass("active"),jQuery("#filter").removeClass("disabled"),kb=1}function k(){if(S){$=S.getLastMessage(),_=S.getPosition(),ab=1,z();var a=b("#ranging-time-wrap").intervalWialon("get");a&&(T=a,b("#paginated-table").width("100%"),l())}}function l(){db=[],bb=parseInt(b("#nrowonpage").val()),R.loadInterval(S.getId(),T[0],T[1],Z,65280,0,qx.lang.Function.bind(function(a,d){if(0===a&&d.count){var e,f={},g="none";S.getUserAccess()&wialon.item.Unit.accessFlag.deleteMessages&&(g="inline-block"),0==Z?(f={display:g,tm:b.localise.tr("Time"),lon:b.localise.tr("Longitude"),lat:b.localise.tr("Latitude"),alt:b.localise.tr(F(S)?"Altitude, ft":"Altitude, m"),loc:b.localise.tr("Location"),speed:b.localise.tr(F(S)?"Speed, mph":"Speed, km/h"),course:b.localise.tr("Course"),scount:b.localise.tr("Satellites"),io:b.localise.tr("I/O"),params:b.localise.tr("Parameters")},e=c.template(b("#data_header").html())):256==Z?(f={display:g,tm:b.localise.tr("Time"),text:b.localise.tr("Text"),phone:b.localise.tr("Phone")},e=c.template(b("#sms_header").html())):512==Z?(f={display:g,tm:b.localise.tr("Time"),cname:b.localise.tr("Commnand name"),ctype:b.localise.tr("Commnand type"),cparams:b.localise.tr("Command parameters"),user:b.localise.tr("User"),channel:b.localise.tr("Channel"),extime:b.localise.tr("Execution time")},e=c.template(b("#command_header").html())):1536==Z&&(f={display:g,tm:b.localise.tr("Time"),type:b.localise.tr("Type"),text:b.localise.tr("Event text"),lon:b.localise.tr("Longitude"),lat:b.localise.tr("Latitude"),params:b.localise.tr("Parameters")},e=c.template(b("#event_header").html())),b("#del_btn").css("display",g),b("#header-wrap").css("display","block"),b("#header-wrap thead").html(e(f)),b("#check_all").click(function(){b("#paginated-table input:enabled").attr("checked",this.checked),b("#del_btn").attr("disabled",!this.checked)}),cb=d.count>fb?fb:d.count,db=[],(!b.isNumeric(ab)||1>ab||ab>parseInt(b("#cpages").html()))&&(ab=1),m(qx.lang.Function.bind(function(){s(),d.count>fb&&alert(sprintf(b.localise.tr("%s messages found. First hundred thousand loaded."),d.count))}))}else b("#header-wrap").css("display","none"),B(),b("#loading").removeClass("show"),alert(b.localise.tr("No data for selected interval."))},this))}function m(a){R.getMessages(0,cb,qx.lang.Function.bind(function(b,c){b||(db=c,a&&"function"==typeof a&&a())}))}function n(){o("next",jQuery._data(b("#next")[0],"events")),o("prev",jQuery._data(b("#prev")[0],"events")),o("last",jQuery._data(b("#last")[0],"events")),o("top",jQuery._data(b("#top")[0],"events"))}function o(a,c){if(c&&c.click&&c.click[0]){var d=c.click.pop(),e=d.handler;b("#"+a).click(function(){var c,d=parseInt(b("#cpages").html());"next"==a?c=ab+1:"prev"==a?c=ab-1:"last"==a?c=d:"top"==a&&(c=1),c>d||1>c||(z(),ab=c,e(),A())})}}function p(a,c){b("#del_btn").attr("disabled",!0),b("#check_all").attr("checked",!1),wialon.core.Remote.getInstance().startBatch();for(var d=0,e=c.length;e>d;d++){var f=c[d];f&&(a=r(a,f))}wialon.core.Remote.getInstance().finishBatch(),b("#paginated-table tr:eq(0) td").resize(function(){clearTimeout(Y),Y=0;var a=b(this).index(),c=b(this).outerWidth();b("#header-wrap th:eq("+a+")").css("min-width",c),b("#header-wrap").width(b("#table-wrap")[0].clientWidth)}),b("#paginated-table input").click(function(){var a=b("#paginated-table input:checked").length;return a?(a==b("#paginated-table input:enabled").length?b("#check_all").attr("checked",!0):b("#check_all").attr("checked",!1),void b("#del_btn").attr("disabled",!1)):(b("#check_all").attr("checked",!1),void b("#del_btn").attr("disabled",!0))}),setTimeout(function(){b("#paginated-table tr:eq(0) td").trigger("resize")},100)}function q(){return S?void(confirm(b.localise.tr("Are you sure you want to delete selected messages?"))&&(z(),wialon.core.Remote.getInstance().startBatch("apply_message"),jQuery("#paginated-table input:checked").each(function(){var a=parseInt(this.id.substr(10));R.deleteMessage(a)}),wialon.core.Remote.getInstance().finishBatch(function(){l()},"apply_message"))):null}function r(a,c){var d=y(a++,c);return b("#paginated-table").children("tbody").append(d),a}function s(){z(),eb=[];for(var a=0;a<db.length;a++)0==Z?eb[a]=t(parseInt(a),db[a]):256==Z?eb[a]=u(parseInt(a),db[a]):512==Z?eb[a]=v(parseInt(a),db[a]):1536==Z&&(eb[a]=w(parseInt(a),db[a]));var c=(ib.param||"").replace(/[\-\[\]\/\{\}\(\)\+\.\\\^\$\|]/g,"\\$&");c=c.replace(/\*/g,".*"),c=c.replace(/\?/g,"."),c&&(c=new RegExp(".*"+c+".*","i")),(ib.param||ib.speed_from||ib.speed_to||ib.sat_from||ib.sat_to)&&(eb=eb.filter(function(a){return c&&"undefined"!=typeof a.params&&!c.test(a.params)?!1:ib.sat_from&&"undefined"!=typeof a.scount&&(a.scount<parseInt(ib.sat_from,10)||"---"==a.scount)?!1:ib.sat_to&&"undefined"!=typeof a.scount&&(a.scount>parseInt(ib.sat_to,10)||"---"==a.scount)?!1:ib.speed_from&&"undefined"!=typeof a.speed&&(a.speed<parseInt(ib.speed_from,10)||"---"==a.speed)?!1:ib.speed_to&&"undefined"!=typeof a.speed&&(a.speed>parseInt(ib.speed_to,10)||"---"==a.speed)?!1:!0})),eb.length?(b("#paginated-table").dividedByPages(eb,p),n(),A()):(A(),B(),alert(b.localise.tr("No messages meet the specified conditions.")))}function t(a,c){var d="none";S.getUserAccess()&wialon.item.Unit.accessFlag.deleteMessages&&(d="inline-block");var e="---",f=c.pos?c.pos.x:e,g=c.pos?c.pos.y:e,h=c.pos?F(S)?Math.round(c.pos.s/1.609344):c.pos.s:e,i=c.pos?F(S)?Math.round(c.pos.z/.3048):c.pos.z:e,j=c.pos?c.pos.c:e,k=c.pos?c.pos.sc:e,l=e,m=e;for(var n in c.p)m==e?m="":m+=", ",m+=n+"="+c.p[n];c.pos&&(l=b.localise.tr("Resolving..."));var o={id:a,index:a+1,display:d,disabled:c.t==$.t||c.t==_.t?"disabled":"",t:c.t,speed:h,lat:g,lon:f,alt:i,loc:l,course:j,scount:k,idata:c.i||0===c.i?c.i.toString(16):"-",odata:c.o||0===c.o?c.o.toString(16):"-",params:m};return o}function u(a,b){var c="none";S.getUserAccess()&wialon.item.Unit.accessFlag.deleteMessages&&(c="inline-block");var d="---",e=b.st?b.st:d,f=b.mp?b.mp:d,g={id:a,index:a+1,display:c,disabled:b.t==$.t||b.t==_.t?"disabled":"",t:b.t,text:e,phone:f};return g}function v(a,c){var d="none";S.getUserAccess()&wialon.item.Unit.accessFlag.deleteMessages&&(d="inline-block");var e="---",f=c.ca?c.ca:e,g=c.cn?b.localise.tr(c.cn):e;"block_engine"==c.cn?g=b.localise.tr("block engine"):"unblock_engine"==c.cn?g=b.localise.tr("unblock engine"):"custom_msg"==c.cn?g=b.localise.tr("custom message"):"driver_msg"==c.cn?g=b.localise.tr("message to driver"):"download_msgs"==c.cn?g=b.localise.tr("download messages"):"query_pos"==c.cn?g=b.localise.tr("query position"):"query_photo"==c.cn?g=b.localise.tr("query snapshot"):"output_on"==c.cn?g=b.localise.tr("activate output"):"output_off"==c.cn?g=b.localise.tr("deactivate output"):"send_position"==c.cn?g=b.localise.tr("send coordinates"):"set_report_interval"==c.cn?g=b.localise.tr("set data transfer interval"):"upload_cfg"==c.cn?g=b.localise.tr("upload configuration"):"upload_sw"==c.cn&&(g=b.localise.tr("upload firmware"));var h=c.cp?c.cp:e,i=e;wialon.core.Session.getInstance().searchItem(c.ui,wialon.item.Item.dataFlag.base,function(c,d){c||b("#msg_"+a+" .user").html(d.getName())});var j=e;c.lt&&(""==c.lt?j=b.localise.tr("Auto"):"gsm"==c.lt?j="SMS":"tcp"==c.lt?j="TCP":"udp"==c.lt?j="UDP":"vrt"==c.lt&&(j="Virtual"));var k=c.et?wialon.util.DateTime.formatTime(c.et,0,U):e,l={id:a,index:a+1,display:d,disabled:c.t==$.t||c.t==_.t?"disabled":"",t:c.t,cname:f,ctype:g,cparams:h,user:i,channel:j,extime:k,ext:c.et};return l}function w(a,c){var d="none";S.getUserAccess()&wialon.item.Unit.accessFlag.deleteMessages&&(d="inline-block");var e=b.localise.tr("Event");16&c.f?e=b.localise.tr("Maintenance"):32&c.f?e=b.localise.tr("Filling"):1&c.f&&(e=b.localise.tr("Violation"));var f=x(c,S),g="---",h=c.x?c.x:g,i=c.y?c.y:g,j=g;for(var k in c.p)j==g?j="":j+=", ",j+=k+"="+c.p[k];var l={id:a,index:a+1,display:d,disabled:c.t==$.t||c.t==_.t?"disabled":"",t:c.t,type:e,text:f,lon:h,lat:i,params:j};return l}function x(a,c){if(!a)return"---";if(a.p&&"object"==typeof a.p&&"undefined"!=typeof a.p.rt_code){if(1==a.p.rt_code)return sprintf(b.localise.tr("Route '%s': round by schedule '%s' started."),a.p.rt_name,a.p.rt_zone);if(2==a.p.rt_code)return sprintf(b.localise.tr("Route '%s': round finished."),a.p.rt_name);if(4==a.p.rt_code)return sprintf(b.localise.tr("Route '%s': round aborted."),a.p.rt_name);if(8==a.p.rt_code)return sprintf(b.localise.tr("Route '%s': arrival at point '%s'."),a.p.rt_name,a.p.rt_pt_name);if(16==a.p.rt_code)return sprintf(b.localise.tr("Route '%s': point '%s' skipped."),a.p.rt_name,a.p.rt_pt_name);if(32==a.p.rt_code)return sprintf(b.localise.tr("Route '%s': departure from point '%s'."),a.p.rt_name,a.p.rt_pt_name);if(64==a.p.rt_code)return sprintf(b.localise.tr("Route '%s': unit is late."),a.p.rt_name);if(128==a.p.rt_code)return sprintf(b.localise.tr("Route '%s': unit is ahead of schedule."),a.p.rt_name);if(256==a.p.rt_code)return sprintf(b.localise.tr("Route '%s': unit returned to schedule."),a.p.rt_name);if(21==a.p.rt_code)return sprintf(b.localise.tr("Route %s: entered %s"),a.p.rt_name,a.p.rt_zone);if(22==a.p.rt_code)return sprintf(b.localise.tr("Route %s: left %s"),a.p.rt_name,a.p.rt_zone)}else if(a.p&&"object"==typeof a.p){if("undefined"!=typeof a.p.prev_bytes_counter)return parseInt(a.p.reset_bytes_counter)?sprintf(b.localise.tr("GPRS traffic counter reset. %d KB consumed."),parseInt(a.p.prev_bytes_counter/1024)):sprintf(b.localise.tr("GPRS traffic counter value: %d KB."),parseInt(a.p.prev_bytes_counter/1024));if("undefined"!=typeof a.p.engine_hours){if(!parseInt(a.p.reset_engine_hours))return sprintf(b.localise.tr("Engine hours counter value is %d h."),parseInt(a.p.engine_hours/3600));if("undefined"!=typeof a.p.new_engine_hours)return sprintf(b.localise.tr("Engine hours counter value was changed from %d h to %d h."),parseInt(a.p.engine_hours/3600),parseInt(a.p.new_engine_hours/3600))}else if("undefined"!=typeof a.p.mileage){if(!parseInt(a.p.reset_mileage))return sprintf(b.localise.tr(F(c)?"Mileage counter value is %d mi.":"Mileage counter value is %d km."),parseInt(a.p.mileage/1e3));if("undefined"!=typeof a.p.new_mileage)return sprintf(b.localise.tr(F(c)?"Mileage counter value was changed from %d mi to %d mi.":"Mileage counter value was changed from %d km to %d km."),parseInt(a.p.mileage/1e3),parseInt(a.p.new_mileage/1e3))}}return a.et}function y(a){var d={},e="";0==Z?(d=eb[a],"---"!=d.lon&&"---"!=d.lat&&M(d.id,d.lon,d.lat),e="#data_row"):256==Z?(d=eb[a],e="#sms_row"):512==Z?(d=eb[a],e="#command_row"):1536==Z&&(d=eb[a],e="#event_row"),d.tm=wialon.util.DateTime.formatTime(d.t,0,U);var f=c.template(b(e).html());return f(d)}function z(){b("#loading").addClass("show"),B()}function A(){b("#loading").removeClass("show"),cb>0&&C()}function B(){b("#table-instruments").hide(),b("#paginated-table").hide(),b("#header-wrap table").hide(),b(window).trigger("resize")}function C(){b("#table-instruments").show(),b("#paginated-table").show(),b("#header-wrap table").show()}function D(){var a=parseInt(b(this).val()),c=Math.floor(cb/a)+1,d=ab;d>c&&(d=c),z(),ab=d,bb=a;var e=b("#paginated-table");e.trigger("changerowonpage",bb),A()}function E(a){if(13===a.which){var c=parseInt(b(this).val()),d=parseInt(b("#cpages").html());(!b.isNumeric(b(this).val())||1>c||c>d)&&(c=ab),z(),ab=c;var e=b("#paginated-table");if(e.trigger("changepage",ab),0==Z){var f;for(var g in eb)f=eb[g],M(f.id,f.lon,f.lat)}A()}}function F(a){var b=a.getMeasureUnits();return b=b?b:0}function G(){var a=function(){b("#paginated-table").width("100%"),b("#table-wrap").width("100%"),b(".table-content").width("100%"),setTimeout(function(){var a=(b("#paginated-table").width(),b("#table-wrap").width(),b(window).outerHeight()-b("#header").outerHeight()-b("#data-inputs").outerHeight()-b(".table-footer").outerHeight()-b("#header-wrap").outerHeight()-1-12);b("#table-wrap").height(a),Y||(Y=setTimeout(function(){b("#paginated-table tr:eq(0) td").each(function(){b(this).triggerHandler("resize")})},100))},200)};a(),b(window).resize(a),b("#type_title").html(b.localise.tr("Type")),b("#filter").attr("title",b.localise.tr("Filter messages")),b("#del_btn").html(b.localise.tr("Delete")),b("#page").html(b.localise.tr("Page&nbsp;")),b("#of").html(b.localise.tr("&nbsp;of&nbsp;")),b("#msg_type").append("<option value='0x000'>"+b.localise.tr("Data")+"</option>"),b("#msg_type").append("<option value='0x100'>SMS</option>"),b("#msg_type").append("<option value='0x200'>"+b.localise.tr("Command")+"</option>"),b("#msg_type").append("<option value='0x600'>"+b.localise.tr("Event")+"</option>"),b("#msg_type").change(j),b("#msg_type").change(k),b("#unit_params").click(L),jQuery("#filter").click(function(){jQuery(this).hasClass("disabled")||(jQuery("#param").val(ib.param||""),jQuery("#speed_from").val(ib.speed_from||""),jQuery("#speed_to").val(ib.speed_to||""),jQuery("#sat_from").val(ib.sat_from||""),jQuery("#sat_to").val(ib.sat_to||""),jQuery("#filter_dialog").toggle())}),b("body").delegate(".sort","click",function(){var a=b(this);a.hasClass("down")?(b(".up, .down").removeClass("up").removeClass("down"),a.addClass("up"),reverse=!0):(b(".up, .down").removeClass("up").removeClass("down"),a.addClass("down"),reverse=!1);var c=function(a,b,c){var d=c?function(b){return c(b[a])}:function(b){return b[a]};return b=b?-1:1,function(a,c){return a=d(a),c=d(c),b*((a>c)-(c>a))}};eb.sort(c(this.id,reverse,!1)),b("#paginated-table").trigger("changepage",ab)}),b("#table-wrap").scroll(function(){b("#header-wrap").scrollLeft(b(this).scrollLeft())});var d=mb("lang");d&&-1!=b.inArray(d,["en","ru"])||(d="en");var e=underi18n.MessageFactory(TRANSLATIONS);b("#filter_dialog").html(c.template(underi18n.template(b("#filter-tpl").html(),e),{LANG:d})),jQuery(".modal-overflow").click(function(a){return(a.target==this||jQuery(a.target).hasClass("close"))&&(jQuery("#filter_dialog").toggle(),jQuery(a.target).hasClass("ok")&&(ib={param:jQuery("#param").val(),speed_from:jQuery("#speed_from").val(),speed_to:jQuery("#speed_to").val(),sat_from:jQuery("#sat_from").val(),sat_to:jQuery("#sat_to").val()},ib.param||ib.speed_from||ib.speed_to||ib.sat_from||ib.sat_to?jQuery("#filter").addClass("active"):jQuery("#filter").removeClass("active"),cb>0&&s())),jQuery(a.target).hasClass("clear")?(jQuery("#param").val(""),jQuery("#speed_from").val(""),jQuery("#speed_to").val(""),jQuery("#sat_from").val(""),void jQuery("#sat_to").val("")):void 0}),b("#nrowonpage").change(D),b("#page_selector").keypress(E),b("#del_btn").click(q),b("#units-select").change(function(){B();var a=[{type:"id",data:this.value,flags:wialon.item.Item.dataFlag.base|wialon.item.Unit.dataFlag.lastMessage|wialon.item.Unit.dataFlag.messageParams,mode:0}];wialon.core.Session.getInstance().updateDataFlags(a,function(a){if(!a){var c=wialon.core.Session.getInstance().getCurrUser().getCustomProperty("us_addr_fmt","");if(c){var d=c.split("_");d&&(wialon.util.Gis.geocodingParams={flags:d[0],city_radius:d[1],dist_from_unit:d[2]})}S=wialon.core.Session.getInstance().getItem(b("#units-select").val()),I()}})}),b("#last_params").click(function(){b(this).hide()}),b("#last_params div").click(function(a){a.stopPropagation()})}function H(a,c){b.datepicker.regional.ru={closeText:"Закрыть",prevText:"Пред",nextText:"След",currentText:"Сегодня",monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],dayNames:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],dayNamesShort:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],weekHeader:"Не",dateFormat:"dd.mm.yy",firstDay:a,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},b.datepicker.regional.sk={closeText:"Zavrieť",prevText:"Pred",nextText:"Ďaľší",currentText:"Dnes",monthNames:["Január","Február","Marec","Apríl","Máj","Jún","Júl","August","September","Október","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","Máj","Jún","Júl","Aug","Sep","Okt","Nov","Dec"],dayNames:["Nedeľa","Pondelok","Utorok","Streda","Štvrtok","Piatok","Sobota"],dayNamesShort:["Ned","Pon","Uto","Str","Štv","Pia","Sob"],dayNamesMin:["Ne","Po","Ut","St","Št","Pia","So"],weekHeader:"Ty",dateFormat:"dd.mm.yy",firstDay:a,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},b.datepicker.regional.ee={closeText:"Sulge",prevText:"&laquo;",nextText:"&raquo;",currentText:"Täna",monthNames:["Jaanuar","Veebruar","Märts","Aprill","Mai","Juuni","Juuli","August","September","Oktoober","November","Detsember"],monthNamesShort:["Jaan","Veebr","Märts","Apr","Mai","Juuni","Juuli","Aug","Sept","Okt","Nov","Dets"],dayNames:["Pühapäev","Esmaspäev","Teisipäev","Kolmapäev","Neljapäev","Reede","Laupäev"],dayNamesShort:["Pühap","Esmasp","Teisip","Kolmap","Neljap","Reede","Laup"],dayNamesMin:["P","E","T","K","N","R","L"],weekHeader:"Sm",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},b.datepicker.regional.fi={closeText:"Sulje",prevText:"&laquo;",nextText:"&raquo;",currentText:"T&auml;n&auml;&auml;n",monthNames:["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kes&auml;kuu","Hein&auml;kuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"],monthNamesShort:["Tammi","Helmi","Maalis","Huhti","Touko","Kes&auml;","Hein&auml;","Elo","Syys","Loka","Marras","Joulu"],dayNamesShort:["Su","Ma","Ti","Ke","To","Pe","Su"],dayNames:["Sunnuntai","Maanantai","Tiistai","Keskiviikko","Torstai","Perjantai","Lauantai"],dayNamesMin:["Su","Ma","Ti","Ke","To","Pe","La"],weekHeader:"Vk",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},b.datepicker.regional.es={closeText:"Cerrar",prevText:"&#x3c;Ant",nextText:"Sig&#x3e;",currentText:"Hoy",monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Mi&eacute;rcoles","Jueves","Viernes","S&aacute;bado"],dayNamesShort:["Dom","Lun","Mar","Mi&eacute;","Juv","Vie","S&aacute;b"],dayNamesMin:["Do","Lu","Ma","Mi","Ju","Vi","S&aacute;"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},b.datepicker.regional.lv={closeText:"Aizvērt",prevText:"Iepr",nextText:"Nāka",currentText:"Šodien",monthNames:["Janvāris","Februāris","Marts","Aprīlis","Maijs","Jūnijs","Jūlijs","Augusts","Septembris","Oktobris","Novembris","Decembris"],monthNamesShort:["Jan","Feb","Mar","Apr","Mai","Jūn","Jūl","Aug","Sep","Okt","Nov","Dec"],dayNames:["svētdiena","pirmdiena","otrdiena","trešdiena","ceturtdiena","piektdiena","sestdiena"],dayNamesShort:["svt","prm","otr","tre","ctr","pkt","sst"],dayNamesMin:["Sv","Pr","Ot","Tr","Ct","Pk","Ss"],weekHeader:"Nav",dateFormat:"dd-mm-yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},b.datepicker.regional.hu={closeText:"bezár",prevText:"vissza",nextText:"előre",currentText:"ma",monthNames:["Január","Február","Március","Április","Május","Június","Július","Augusztus","Szeptember","Október","November","December"],monthNamesShort:["Jan","Feb","Már","Ápr","Máj","Jún","Júl","Aug","Szep","Okt","Nov","Dec"],dayNames:["Vasárnap","Hétfő","Kedd","Szerda","Csütörtök","Péntek","Szombat"],dayNamesShort:["Vas","Hét","Ked","Sze","Csü","Pén","Szo"],dayNamesMin:["V","H","K","Sze","Cs","P","Szo"],weekHeader:"Hét",dateFormat:"yy.mm.dd.",firstDay:1,isRTL:!1,showMonthAfterYear:!0,yearSuffix:""},b.datepicker.setDefaults(b.datepicker.regional[lb]);var d={template:b("#ranging-time-tpl").html(),labels:{yesterday:b.localise.tr("Yesterday"),today:b.localise.tr("Today"),week:b.localise.tr("Week"),month:b.localise.tr("Month"),custom:b.localise.tr("Custom"),ok:"OK"},datepicker:{},onInit:function(){b("#ranging-time-wrap").intervalWialon("set",0)},onChange:function(a){J.apply(this,a)},onAfterClick:function(){b(".date-time-content").resize()},tzOffset:wialon.util.DateTime.getTimezoneOffset()+wialon.util.DateTime.getDSTOffset(),now:wialon.core.Session.getInstance().getServerTime()};d.dateFormat=wialon.util.DateTime.convertFormat(c.split("_")[0],!0),d.firstDay=a,b("#ranging-time-wrap").intervalWialon(d)}function I(){z(),null!==Q&&clearTimeout(Q),Q=setTimeout(function(){k(),clearTimeout(Q),Q=null},1e3)}function J(a,b){b&&(a=parseInt(a,10),4==a&&null===hb.time_custom&&(hb.time_custom=b),hb.time_type=a,I(),K(a))}function K(a){b("#time-select .time-template.active").removeClass("active");var c=b("#time_"+a);return c||c.length?(0===a||1===a?(hb.time_from==gb.from-86400&&hb.time_to==gb.to-172800+1||hb.time_from==gb.from&&hb.time_to==gb.to-86399)&&c.addClass("active"):c.addClass("active"),b(".date-time-content").resize(),!0):!1}function L(){b("#params_table").html(""),wialon.core.Session.getInstance().searchItem(b("#units-select").val(),wialon.item.Item.dataFlag.base|wialon.item.Unit.dataFlag.messageParams,function(a,c){if(!a){var d=b("#unit_params").offset().top,e=b("#unit_params").offset().left,f=b("#unit_params").height()+3;b("#last_params div").css("top",d+f),b("#last_params div").css("left",e),b("#last_params div").css("max-height",b(window).outerHeight()-d-f),b("#last_params").show();var g=c.getMessageParams();if(wialon.util.Json.compareObjects(g,{}))return void b("#params_table").append("<tr><td>"+b.localise.tr("No available parameters")+"</td></tr>");b("#params_table").append("<tr><td colspan=2 class='caption'>"+b.localise.tr("Latest parameters")+"</td></tr>");var h=function(a,c){if(a&&"undefined"!=typeof c){var d="<tr><td class='title'>"+a+"</td><td>"+c+"</td></tr>";b("#params_table").append(d);var e=b("#last_params div")[0].clientWidth,f=b("#last_params div")[0].scrollWidth;e!=f&&b("#last_params div").width(f)}};g.posinfo&&(h(b.localise.tr("Longitude"),g.posinfo.v.x),h(b.localise.tr("Latitude"),g.posinfo.v.y),h(b.localise.tr("Altitude"),g.posinfo.v.z?(F(c)?3.281*g.posinfo.v.z:g.posinfo.v.z)+" "+b.localise.tr(F(c)?"ft":"m"):"---"),h(b.localise.tr("Course"),g.posinfo.v.c),h(b.localise.tr("Satellites"),g.posinfo.v.sc)),g.speed&&h(b.localise.tr("Speed"),(F(c)?Math.round(g.speed.v/1.609344):g.speed.v)+" "+b.localise.tr(F(c)?"mph":"km/h"));var i="-";g["in"]&&(g["in"].v||0===g["in"].v)&&(i=g["in"].v.toString(16));var j="-";g.out&&(g.out.v||0===g.out.v)&&(j=g.out.v.toString(16)),(g["in"]||g.out)&&h(b.localise.tr("I/O"),i+"/"+j);for(var k in g)"speed"!=k&&"in"!=k&&"out"!=k&&"posinfo"!=k&&h(k,g[k].v)}})}function M(a,b,c){V[a]={lon:b,lat:c,st:!1},W||(W=setTimeout(N,1e3))}function N(){if(W&&(clearTimeout(W),W=0),V&&!X){X=!0;var a=[],c=[],d=[];for(var e in V){var f=V[e];"undefined"!=typeof f&&f&&!f.st?(f.st=!0,c.push({lat:f.lat,lon:f.lon}),a.push(e)):d.push(e)}for(var g=0;g<d.length;g++){var e=d[g];"undefined"!=typeof V[e]&&delete V[e]}c.length?wialon.util.Gis.getLocations(c,qx.lang.Function.bind(function(a,c,d){if(!c&&(X=!1,d&&a&&d.length==a.length)){for(var e=0;e<d.length&&e<a.length;e++)O(a[e],d[e]);b("#msg_0 .location").trigger("resize"),b(window).resize()}},this,a)):X=!1}}function O(a,c){b("#msg_"+a+" .location").html(c)}function P(){var a=[b.localise.tr("Sunday"),b.localise.tr("Monday"),b.localise.tr("Tuesday"),b.localise.tr("Wednesday"),b.localise.tr("Thursday"),b.localise.tr("Friday"),b.localise.tr("Saturday")],c=[b.localise.tr("January"),b.localise.tr("February"),b.localise.tr("March"),b.localise.tr("April"),b.localise.tr("May"),b.localise.tr("June"),b.localise.tr("July"),b.localise.tr("August"),b.localise.tr("September"),b.localise.tr("October"),b.localise.tr("November"),b.localise.tr("December")],d=[b.localise.tr("Sun"),b.localise.tr("Mon"),b.localise.tr("Tue"),b.localise.tr("Wed"),b.localise.tr("Thu"),b.localise.tr("Fri"),b.localise.tr("Sat")],e=[b.localise.tr("Jan"),b.localise.tr("Feb"),b.localise.tr("Mar"),b.localise.tr("Apr"),b.localise.tr("May"),b.localise.tr("Jun"),b.localise.tr("Jul"),b.localise.tr("Aug"),b.localise.tr("Sep"),b.localise.tr("Oct"),b.localise.tr("Nov"),b.localise.tr("Dec")];wialon.util.DateTime.setLocale(a,c,d,e)}var Q,R=null,S=null,T=null,U="",V={},W=0,X=!1,Y=0,Z=0,$=null,_=null,ab=1,bb=10,cb=0,db=[],eb=[],fb=1e5,gb={from:0,to:0},hb={time_from:0,time_to:0,time_custom:null,time_type:0},ib={},jb={},kb=1,lb="en",mb=c.memoize(function(a){if(!a)return null;for(var b=decodeURIComponent(document.location.search.substr(1)).split("&"),c=0;c<b.length;c++){var d=b[c].split("=");if(d[0]===a)return d.splice(0,1),d.join("=")}return null});b(document).ready(function(){B();var a=mb("baseUrl");return a||(a=mb("hostUrl")),a?(a+="/wsdk/script/wialon.js",lb=mb("lang"),lb&&-1!=b.inArray(lb,["en","ru"])||(lb="en"),b.localise("lang/",{language:lb}),b("#help").html('<a target="_blank" href="/docs/'+("ru"===lb?lb:"en")+'/messagesmanager.html"><img src="./img/help.png" height="24" width="24"></a>'),G(),void f(a,i)):null})}(jQuery,_);